---
title: "Company Analysis Report"
author: "Abeer Gaber"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    number_sections: true
    theme: cerulean
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

suppressWarnings(suppressPackageStartupMessages({
  library(dplyr)
  library(ggplot2)
  library(scales)
  library(tidyr)
  library(ggthemes)
  library(kableExtra)
  library(DT)
  library(randomForest)
  library(caret)
}))
```

## Enough Falling â€“ Itâ€™s Time to Rise

Do you remember Blackberry, Metro-Goldwyn-Mayer (MGM), Toys â€˜Râ€™ Us, Atari, and Karmelkorn?

Some will recognize these namesâ€”companies that were once very famous and lasted for years.

What happened to them? Why did they stop? Why couldnâ€™t they keep going?

If you want to avoid the same fate, this report is for you.

It analyzes financial performance, stock trends, and employee data across many companies to identify patterns of survival and closure.

By understanding the traits of both successful and failed companies, I provide actionable insights and strategies to help you avoid failure and thrive in a competitive market.



```{r}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(readr)
library(knitr)
library(gt)
library(lubridate)
library(corrplot)
library(tidyr)
library(forecast)
```


```{r load-data}
companies_mergedData <- read.csv("D:/Data Analysis/Company_Analysis_Project/companies_mergedData.csv")
companies_mergedData <- companies_mergedData %>% 
  select(-X)
```

# Data Overview

```{r data-glimpse}
str(companies_mergedData)
summary(companies_mergedData)
```

```{r show-table, results='asis'}
head(companies_mergedData) %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

## ðŸ“Š Company Status: Who Survived and Who Didn't

**Insight:**  
This visualizations shows various distributions of companies by their statusâ€”whether they are still operational or have closed.

# Company Lifespan by Status
The lifespan of companies shows a significant difference between those that survived and those that didnâ€™t. Defunct companies tend to have shorter lifespans.
Lifespan is an important measure of company health.
Letâ€™s compare the lifespans of active and defunct companies using the Status dataset.

```{r status-distribution}
ggplot(companies_mergedData, aes(x = Current_Status, fill = Current_Status)) +
  geom_bar() +
  labs(title = "Number of Companies by Status", x = "Current_Status", y = "Count") +
  theme_minimal()
```
**Actionable Takeaway:**  
If your company is in the closure group, it is essential to analyze the contributing factors and take immediate action to turn the trend around.

**Insight:**  
This boxplot compares the lifespans of companies based on their status. 

**Actionable Takeaway:**  
A companyâ€™s ability to extend its lifespan depends on factors like financial management, adaptability, and market positioning. If your company is near the lower end of the lifespan spectrum, it is crucial to reassess its strategies, focusing on long-term sustainability rather than short-term gains.

## Employee Count: Employee Distribution by Company Status
Employee count is another factor that can help determine company success.
A significant drop in employee numbers is often seen in companies that are in decline.
Companies that are growing or stable tend to have a steady increase in their employee base.
Letâ€™s look at how the number of employees varies based on company status.

# Data Summary for Employee Count
```{r emp-count-summary}
dim(companies_mergedData$Employee_Number)          # Dimensions
str(companies_mergedData$Employee_Number)          # Structure
summary(companies_mergedData$Employee_Number)      # Summary statistics
sum(is.na(companies_mergedData$Employee_Number))   # Count missing values
```

# Employee Count Distribution by Company Status

```{r emp-histogram}
ggplot(companies_mergedData, aes(x = Employee_Number, fill = Current_Status)) +
  geom_histogram(bins = 30) +
  theme_minimal() +
  labs(title = "Employee Count Distribution by Company Current Status",
       x = "Number of Employees", y = "Count")
```

## ðŸ“ˆ Revenue Over Time  
Revenue is a key indicator of a companyâ€™s financial performance.
Companies that have closed often show erratic or decreasing revenue trends, while active companies tend to have more stable or growing revenues.
Letâ€™s explore how revenue varies across companies based on their status (active vs. defunct).

**Insight:**  
This line chart and histogram visualize the revenue trends of companies over time, categorized by their status. Healthy companies show consistent or growing revenue over the years, while companies that close often experience sharp declines or erratic fluctuations in revenue.

**Actionable Takeaway:**  
If your revenue is showing a decline or significant fluctuation, it is a red flag. To avoid closure, consider analyzing the reasons behind these revenue dropsâ€”such as market shifts, cost inefficiencies, or competitionâ€”and make adjustments like cost-cutting, diversifying product lines, or improving marketing efforts.

```{r revenue-trend}
ggplot(companies_mergedData, aes(x = Years, y = Revenue, group = Company_Name, color = Current_Status)) +
  geom_line(alpha = 0.6) +
  labs(title = "Revenue Trends Over Time", x = "Year", y = "Revenue") +
  theme_minimal()
```

# Net Income vs. Revenue

```{r income-vs-revenue}
ggplot(companies_mergedData, aes(x = Revenue, y = Net_Income, color = Current_Status)) +
  geom_point(alpha = 0.7) +
  labs(title = "Net Income vs Revenue", x = "Revenue", y = "Net Income") +
  theme_minimal()
```

## Prediction Model: Forecasting Future Company Status
Letâ€™s build a predictive model using the data to identify which companies are more likely to continue, and which ones might be closed.

```{r}
# Prepare data
model_data <- companies_mergedData %>%
  filter(Current_Status %in% c("Active", "Defunct", "Re-Opened")) %>%
  mutate(Status_Class = as.factor(Current_Status)) %>%
  select(Status_Class, Foundation_Year, Closing_Year, Duration, Employee_Number,
         Revenue, Net_Income, Assets, long_Term_Debt, Total_Liabilities,
         Holders_Equity, Avg_Stock_Price, Avg_TTM_Net_EPS, Avg_PE_Ratio) %>%
  drop_na()

# Split into train/test sets
set.seed(42)
trainIndex <- createDataPartition(model_data$Status_Class, p = 0.8, list = FALSE)
train <- model_data[trainIndex, ]
test <- model_data[-trainIndex, ]

# Train random forest model
rf_model <- randomForest(Status_Class ~ ., data = train, ntree = 300, importance = TRUE)

# Predictions on test set
test$Prediction <- predict(rf_model, newdata = test)

# Confusion matrix
confusionMatrix(test$Prediction, test$Status_Class)

```

## Feature Importance
```{r}
# Plot feature importance
varImpPlot(rf_model)
```

## Company-Level Summaries
```{r}
summary_table <- companies_mergedData %>%
  group_by(Company_Name, Status) %>%
  summarise(
    Avg_Revenue = mean(Revenue, na.rm = TRUE),
    Avg_Net_Income = mean(Net_Income, na.rm = TRUE),
    Avg_Stock_Price = mean(Avg_Stock_Price, na.rm = TRUE),
    Avg_PE = mean(Avg_PE_Ratio, na.rm = TRUE),
    .groups = 'drop')

datatable(summary_table)
```
## âš ï¸ Critical Warning for At-Risk Companies

If your company has been flagged by the prediction model as â€œDefunctâ€ or at risk, this is not just a data pointâ€”it's a wake-up call.

Your financial indicators, operational trends, and employee patterns mirror those of companies that have already failed.

Unless immediate and strategic actions are taken, your company may face irreversible closure.

This report has highlighted the exact warning signsâ€”declining revenue, shrinking employee numbers, rising liabilities, and reduced investor confidence.

You are not out of time yetâ€”but you're close.

Take this prediction seriously:

Reassess your business model.

Cut non-essential costs.

Innovate your offerings.

Rebuild trust with investors and employees.

The next move you make could decide your companyâ€™s fate. Delay is the most dangerous option.


## ðŸ’° Stock Price and PE Ratio
**Stock Trends:**
Companies with increasing stock prices tend to have better financial performance and longevity. On the other hand, companies with fluctuating or decreasing stock prices may face challenges.
We will analyze the stock data to visualize how different companies' stock prices have evolved over time.

**Insight:**  
This scatter plot shows the relationship between the Price-to-Earnings (PE) ratio and the average stock price. Companies that are financially healthy often have a higher PE ratio, indicating that investors have more confidence in their future earnings potential.

**Actionable Takeaway:**  
A low PE ratio can indicate that your company is undervalued or struggling. To boost the PE ratio, consider improving profitability by increasing revenue, reducing costs, or communicating your company's growth potential more effectively to investors.

**Important Note:**  
As the chart shows, the overall average revenue among companies is 5 million, reflecting the good performance of the companies that survived compared to those that closed.

# Average PE Ratio by Status

```{r pe-ratio-by-status}
companies_mergedData %>%
  group_by(Status) %>%
  summarise(avg_pe = mean(Avg_PE_Ratio, na.rm = TRUE)) %>%
  ggplot(aes(x = Status, y = avg_pe, fill = Status)) +
  geom_col() +
  labs(title = "Average PE Ratio by Company Status", x = "Status", y = "Avg PE Ratio") +
  theme_minimal()
```

# Average Stock Price Distribution

```{r stock-price-distribution}
ggplot(companies_mergedData, aes(x = Avg_Stock_Price, fill = Status)) +
  geom_histogram(bins = 30, alpha = 0.7, position = "identity") +
  labs(title = "Average Stock Price Distribution", x = "Stock Price", y = "Frequency") +
  theme_minimal()
```

# Company-Level Summaries

```{r company-summary-table}
summary_table <- companies_mergedData %>%
  group_by(Company_Name, Status) %>%
  summarise(
    Avg_Revenue = mean(Revenue, na.rm = TRUE),
    Avg_Net_Income = mean(Net_Income, na.rm = TRUE),
    Avg_Stock_Price = mean(Avg_Stock_Price, na.rm = TRUE),
    Avg_PE = mean(Avg_PE_Ratio, na.rm = TRUE),
    .groups = 'drop')

datatable(summary_table)
```

## Key Takeaways and Survival Strategies:

**Financial Health:**  
Regularly monitor key financial metrics (e.g., revenue, profit margins, debt) to identify signs of distress early.

**Customer Focus:**  
Reassess your customer needs and the value youâ€™re offering. Adapt to shifting market demands and invest in customer loyalty.

**Case Study:**  
Apple successfully navigated financial and market crises by embracing new technologies such as touchscreen interfaces and app ecosystems. These innovations drastically improved product appeal, operational efficiency, and customer engagement. In contrast, BlackBerry failed to adapt to changing consumer demands and technological trends, holding on to outdated features like physical keyboards and enterprise-focused software. As a result, Apple thrived while BlackBerry's market share collapsed.

**Lesson:**  
Companies that proactively adopt relevant technologies and innovate based on market needs are more likely to survive and grow, while those that resist change risk becoming obsolete.

**Investor Confidence:**  
If your PE ratio is low, focus on improving profitability and communicating your vision to investors. Strong communication about future growth can rebuild confidence.

**Operational Efficiency:**  
Short lifespans and closures often result from poor management or operational inefficiencies. Regular audits of operations, cost control measures, and innovation can prevent stagnation.

**Adaptability:**  
The ability to pivot or adapt to market conditions is essential for long-term survival. Companies that failed typically couldnâ€™t adapt quickly enough to external changes like technology shifts, regulatory changes, or market demands.

**Conclusion:**
In conclusion, by analyzing stock trends, financial performance, employee count, and company lifespan, we can gain valuable insights into the factors that contribute to a companyâ€™s survival or closure. Understanding these factors can help in making strategic decisions to avoid company closure and ensure long-term success.
